<div class="w-[95%] mx-auto">
    <div class="flex justify-between items-center mb-4">
    <div class="flex flex-col gap-2">
        <h2 class="text-xl font-semibold" style="margin: 0;">Task Management</h2>
        <p class="ml-5">Overview of tasks</p>
    </div>
    <a [routerLink]="['/tasks/create']" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">
        Add +
    </a>
    </div>
</div>


<div class="w-[95%] mx-auto bg-white p-6 rounded-lg shadow-md">
  <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
    <input 
      type="text" 
      class="border p-2 rounded-md w-full md:w-1/3 focus:outline-none focus:ring-2 focus:ring-blue-500" 
      placeholder="Search by title" 
      [(ngModel)]="searchTerm" 
      (ngModelChange)="applySearchFilter()"
    />
    <select 
      class="border p-2 rounded-md w-full md:w-1/3 focus:outline-none focus:ring-2 focus:ring-blue-500" 
      [(ngModel)]="statusFilter" 
      (ngModelChange)="applySearchFilter()"
    >
      <option value="">All Statuses</option>
      <option *ngFor="let status of taskStatus | keyvalue" [value]="status.value">{{ status.value }}</option>
    </select>
  </div>

  <div *ngIf="loading" class="bg-blue-100 text-blue-700 p-4 rounded mb-4">Loading...</div>
  <div *ngIf="error" class="bg-red-100 text-red-700 p-4 rounded mb-4">{{ error }}</div>

  <div class="overflow-x-auto">
    <table class="w-full border-collapse">
      <thead>
        <tr class="bg-gray-100">
          <th class="p-2 text-left">S/N</th>
          <th class="p-2 text-left">Title</th>
          <th class="p-2 text-left">Status</th>
          <th class="p-2 text-left">Due Date</th>
          <th class="p-2 text-left">Priority</th>
          <th class="p-2 text-left">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let task of filteredTasks | paginate: { itemsPerPage: itemsPerPage, currentPage: currentPage }; let i = index" class="border-b">
          <td class="p-2">{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
          <td class="p-2">{{ task.title }}</td>
          <td class="p-2">{{ task.status }}</td>
          <td class="p-2">{{ task.dueDate | date: 'dd-MM-yy' }}</td>
          <td class="p-2">{{ task.priority }}</td>
          <td class="p-2">
            <a [routerLink]="['/tasks/edit', task.id]" class="text-blue-500 hover:underline mr-2"><i class="ri-pencil-line text-lg"></i></a>
            <button 
              id="delete-task-{{ task.id }}" 
              class="text-red-500 hover:underline" 
              (click)="popDeleteModal(task.id!, task.title, 'delete-task-' + task.id)"
            >
              <i class="ri-delete-bin-line text-lg"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
<!-- Pagination -->
    <div class="flex gap-3 flex-wrap justify-end mt-2">
      <mat-form-field>
        <mat-label>Items Per Page</mat-label>
        <mat-select [(value)]="itemsPerPage">
          @for (n of pageItemsList; track n) {
          <mat-option [value]="n">{{n}}</mat-option>
          }
        </mat-select>
      </mat-form-field>
      <app-pagenation [totalItems]="filteredTasks.length" (currentPage)="pageChanged($event)"></app-pagenation>
    </div>
 <!-- <app-pagenation [totalItems]="filteredTasks.length" (currentPage)="pageChanged($event)"></app-pagenation> -->

</div>

<app-confirm-modal
  [isOpen]="showDeleteModal"
  [title]="'Delete Task'"
  [message]="'Are you sure you want to delete the task: <b>' + deleteTaskTitle + '</b>? This action cannot be undone.'"
  (close)="closeDeleteModal()"
  (confirm)="deleteTask('delete-task-' + deleteTaskId)"
></app-confirm-modal>